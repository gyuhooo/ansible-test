- name: check composer
  stat: path=/usr/local/bin/composer
  register: composer_bin
  tags: composer
- block:
  - name: download composer
    get_url:
      url: https://getcomposer.org/installer
      dest: /tmp/composer-setup.php
  - name: install composer
    shell: export HOME=/root && export COMPOSER_HOME=/root && chdir=/tmp php composer-setup.php --install-dir=/usr/local/bin
  - option_settings:
    - namespace: aws:elasticbeanstalk:application:environment
      option_name: COMPOSER_HOME
      value: /root
    - namespace: aws:elasticbeanstalk:application:environment
      option_name: HOME
      value: /root
  - name: rename composer.phar to composer
    shell: mv /usr/local/bin/composer.phar /usr/local/bin/composer
  - name: make composer executable
    file:
      path: /usr/local/bin/composer
      mode: a+x
      state: file
  when: not composer_bin.stat.exists
  tags: composer

